#!/usr/bin/env bash
tail -n +3 $0 | dot -Tsvg > ${0%dot}svg && exit 0
digraph {
    node [fontname=menlo shape=record]
    rankdir=LR

    subgraph cluster_driver {
        label="Master" fontname=menlo
        subgraph cluster_jvm {
            label="JVM"
            Spark
        }
    }

    subgraph cluster_laptop {
        label="Your Laptop / Driver" fontname=menlo
        subgraph cluster_notebook {
            label="Python (e.g. in a notebook)"
            pyspark [label="pyspark"]
            pyspark -> Spark [label="talks to"]
        }
    }

    subgraph executors {
        e1 [label="{Executor|{data partition|data partition|data partition|data partition}}"]
        e2 [label="{Executor|{data partition|data partition|data partition|data partition}}"]
        e3 [label="{Executor|{data partition|data partition|data partition|data partition}}"]
    }

    Spark -> {e1, e2, e3} [label="work"]

    /* {rank=min; JVM, pyspark} */
    {rank=max; e1, e2, e3}
}
